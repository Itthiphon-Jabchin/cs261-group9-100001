<!DOCTYPE html>
<html lang="th"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>รายละเอียดงาน</title>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap"
          rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inria+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>

<div class="navbar">
    <div class="logo">VolunteeU</div>
    <div class="nav-links">
        <a href="/" class="active" style="font-weight: bold;">Home</a>

        <th:block sec:authorize="hasAuthority('ROLE_STUDENT')">
            <a th:href="@{/student/applications}">Application</a>
        </th:block>

        <th:block sec:authorize="hasAuthority('ROLE_TEACHER')">
            <a th:href="@{/teacher/jobs}">Posts</a>
        </th:block>

        <th:block sec:authorize="isAuthenticated()">
            <a th:href="@{/profile}">Profile</a>

            <form method="post" action="/logout" th:object="${_csrf}" style="display:inline; margin-left: 25px;">
                <input type="hidden" th:name="*{parameterName}" th:value="*{token}" />
                <button type="submit"
                        style="background:none; border:none; color:#A3062C; cursor:pointer;">Logout</button>
            </form>
        </th:block>

        <th:block sec:authorize="isAnonymous()">
            <a href="/login">Login</a>
        </th:block>
    </div>
</div>

<div class="main-content">
    <div class="application">
        <div th:if="${err}" 
            style="background-color:#ffdddd; color:#a10000; padding:10px; border-radius:8px; margin-bottom:15px;">
          <p th:text="${err}"></p>
        </div>

        <div th:if="${msg}" 
           style="background-color:#ddffdd; color:#006600; padding:10px; border-radius:8px; margin-bottom:15px;">
          <p th:text="${msg}"></p>
        </div>
        
        <div th:if="${job != null}">
            <div class="job_detail_header">
                <h1 th:text="${job.title}">Staff งานรับเพื่อนใหม่ TU92</h1>
                <p class="job-description" th:text="${job.description}">
                    รายละเอียดเกี่ยวกับงานและหน้าที่ที่ต้องรับผิดชอบ
                </p>
            </div>

            <!-- ✅ แสดงฟอร์มเฉพาะ ROLE_STUDENT เท่านั้น -->
            <div sec:authorize="hasAuthority('ROLE_STUDENT')">
                <div th:if="${alreadyApplied}">
                    <p class="status-message status-success"><b>คุณส่งใบสมัครแล้ว</b></p>
                </div>

                <form th:if="${!alreadyApplied}" method="post" th:action="@{|/jobs/${job.id}/apply|}" th:object="${_csrf}"
                      class="application-form">
                    <input type="hidden" th:name="*{parameterName}" th:value="*{token}" />

                    <h2 class="form-section-title">Personal Detail</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fullName">ชื่อ-นามสกุล</label>
                            <input type="text" id="fullName" name="fullName" 
                                   required
                                   pattern="^[A-Za-zก-๙\s]+$"
                                   title="ชื่อ-นามสกุลต้องเป็นตัวอักษรเท่านั้น"
                                   placeholder="Enter your full name" />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="studentId">รหัสนักศึกษา</label>
                            <input type="text" id="studentId" name="studentId"
                                   pattern="\d{10}"
                                   title="รหัสนักศึกษาต้องเป็นตัวเลข 10 หลัก"
                                   placeholder="Enter your student ID" />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">อีเมล</label>
                            <input type="email" id="email" name="email"  
                                   required
                                   title="กรุณากรอกอีเมลให้ถูกต้อง เช่น name@email.com"
                                   placeholder="Enter your email" />
                        </div>
                        <div class="form-group">
                            <label for="phone">โทรศัพท์</label>
                            <input type="text" id="phone" name="phone"
                                   required
                                   pattern="0\d{9}"
                                   title="เบอร์โทรศัพท์ต้องขึ้นต้นด้วย 0 และมี 10 หลัก" 
                                   placeholder="Enter your phone number" />
                        </div>
                    </div>

                    <h2 class="form-section-title">Application Question</h2>

                    <div class="form-group">
                        <label for="answerText" th:text="${job.questionPrompt}">คำถามจากอาจารย์:</label>
                        <textarea id="answerText" name="answerText"
                                  required
                                  minlength="1"
                                  title="กรุณากรอกเหตุผลในการสมัครงาน" 
                                  placeholder="Enter your answer">
                        </textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="job_detail_btn btn-cancel"
                                onclick="history.back()">Cancel</button>
                        <button type="submit" class="job_detail_btn btn-submit">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ✅ สำหรับอาจารย์ (Teacher) -->
    <div sec:authorize="hasAuthority('ROLE_TEACHER')">
        <p class="status-message status-info"><i>บัญชีอาจารย์ไม่สามารถสมัครงานได้</i></p>
    </div>

    <!-- ✅ สำหรับผู้ที่ยังไม่ล็อกอิน -->
    <div sec:authorize="isAnonymous()">
        <p class="status-message status-info">กรุณาเข้าสู่ระบบเพื่อสมัคร</p>
    </div>

    <!-- ✅ กรณีไม่พบงาน -->
    <div th:if="${job == null}">
        <p class="status-message status-error">ไม่พบบันทึกงาน</p>
    </div>
</div>

<div class="footer">
    © 2025 VolunteeU — Software Project Recruitment
</div>

</body>
</html>
